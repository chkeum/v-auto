# v-auto v2.0 μΈν”„λΌ μ΄μ κ°€μ΄λ“ (Infrastructure Guide)

> **λ€μƒ λ…μ**: ν”λ«νΌ μ—”μ§€λ‹μ–΄, μΈν”„λΌ κ΄€λ¦¬μ (Admin)  
> **λ©ν‘**: ν‘μ¤€ ν™κ²½(λ„¤νΈμ›ν¬, μ΄λ―Έμ§€, μ¤ν† λ¦¬μ§€)μ„ μ •μν•κ³  μ‹μ¤ν…μ„ μ μ§€λ³΄μν•λ‹¤.

---

## 1. μΈν”„λΌ λ””λ ‰ν† λ¦¬ κµ¬μ΅° (Decentralized)
 
v1.0 μ•„ν‚¤ν…μ²λ” **"ν”„λ΅μ νΈλ³„ λ…λ¦½ μΈν”„λΌ"**λ¥Ό μ§€ν–¥ν•©λ‹λ‹¤.
κ° ν”„λ΅μ νΈ ν΄λ” μ•μ— μ „μ© `infrastructure/`κ°€ μ΅΄μ¬ν•λ©°, κΈ€λ΅λ² μ„¤μ •μ€ μ—†μµλ‹λ‹¤.

```text
v-auto/
β”β”€β”€ vm_manager.py
β””β”€β”€ projects/
    β””β”€β”€ [ν”„λ΅μ νΈλ…]/
        β”β”€β”€ specs/           # VM μ¤ν™ μ •μ
        β”β”€β”€ config.yaml      # ν”„λ΅μ νΈ κΈ°λ³Έ μ„¤μ •
        β””β”€β”€ infrastructure/  # π‘ μΈν”„λΌ(λ„¤νΈμ›ν¬/μ΄λ―Έμ§€) μ •μ
            β”β”€β”€ networks.yaml
            β”β”€β”€ images.yaml
            β””β”€β”€ storage.yaml
```

### π“„ `networks.yaml` μ‘μ„±λ²•
μ‚¬μ©μκ°€ `network: svc-net`μ΄λΌκ³  μ μ—μ„ λ•, μ‹¤μ  λ§¤ν•‘λ  λ¬Όλ¦¬μ  μ •λ³΄λ¥Ό μ •μν•©λ‹λ‹¤.

```yaml
networks:
  svc-net:
    # 1. OpenShift NAD (NetworkAttachmentDefinition) μ„μΉ
    nad: default/svc-net-nad
    
    # 2. IPAM λ° κ²μ΄νΈμ›¨μ΄ μ •λ³΄ (μλ™ μ£Όμ…μ©)
    subnet: 10.215.100.0/24
    gateway: 10.215.100.1
    dns: [8.8.8.8, 1.1.1.1]
```

### π“„ `images.yaml` μ‘μ„±λ²•
μ‚¬μ©μκ°€ μ‚¬μ©ν•  μ μλ” OS μ΄λ―Έμ§€ λ©λ΅μ„ ν†µμ ν•©λ‹λ‹¤.

```yaml
images:
  ubuntu-22.04:
    url: "http://repo.internal/images/ubuntu-22.04.qcow2"
    min_cpu: 2  # μµμ† μ”κµ¬ μ‚¬μ–‘ κ°•μ 
    min_mem: 2Gi
```

---

## 2. λ³΄μ• λ° μλ™ν™” λ©”μ»¤λ‹μ¦

### π”’ κ΄€λ¦¬μ λ°±λ„μ–΄ (Admin Keys)
μ‚¬μ©μκ°€ μ–΄λ–¤ μ„¤μ •μ„ ν•λ“ , μ΄μν€μ΄ μ–Έμ λ“  VMμ— μ ‘μ†ν•  μ μμ–΄μ•Ό ν•©λ‹λ‹¤.
*   `vm_manager.py`λ” λ°°ν¬ μ‹ **`infrastructure/admin.pub` (μ΅΄μ¬ν•  κ²½μ°)** ν‚¤λ¥Ό λ¨λ“  VMμ— μλ™μΌλ΅ μ‹¬μµλ‹λ‹¤.
*   λΉ„μƒμ‹ μ΄μν€μ Private Keyλ΅ μ ‘μ†ν•μ—¬ λ³µκµ¬ν•  μ μμµλ‹λ‹¤.

### π›΅οΈ λΉ„λ°€λ²νΈ ν•΄μ‹± (Password Hashing)
`vm_manager.py`λ” Python `crypt` λ¨λ“(SHA-512)μ„ λ‚΄μ¥ν•κ³  μμµλ‹λ‹¤.
*   μ‚¬μ©μκ°€ μ…λ ¥ν• λΉ„λ°€λ²νΈλ” μ¦‰μ‹ ν•΄μ‹±λμ–΄ `cloud-init`μ— κΈ°λ΅λ©λ‹λ‹¤.
*   `/etc/shadow` νμΌμ— μ•μ „ν•κ² μ €μ¥λλ―€λ΅, `cloud-init` λ΅κ·Έλ¥Ό νƒμ·¨λ‹Ήν•΄λ„ λΉ„λ°€λ²νΈ μ›λ¬Έμ„ μ• μ μ—†μµλ‹λ‹¤.

---

## 3. Gitops λ° λ°°ν¬ κ΄€λ¦¬

### λ³€κ²½μ‚¬ν•­ μ»¤λ°‹ (Git Sync)
μΈν”„λΌ μ„¤μ •μ΄λ‚ μ½”λ“λ¥Ό λ³€κ²½ν• ν›„μ—λ” λ°λ“μ‹ μ¤ν¬λ¦½νΈλ¥Ό ν†µν•΄ μ»¤λ°‹ν•μ‹­μ‹μ¤.

```bash
# μ‚¬μ©λ²•: ./git_sync.sh "μ»¤λ°‹ λ©”μ‹μ§€"
./git_sync.sh "Update network gateway"
```
μ΄ μ¤ν¬λ¦½νΈλ” νμ‡„λ§ λ°°ν¬λ¥Ό μ„ν• **μ¤ν”„λΌμΈ λ²λ“¤(`tar.gz`)**λ„ μλ™μΌλ΅ μƒμ„±ν•©λ‹λ‹¤.

---

## 4. λ¬Έμ  ν•΄κ²° (Troubleshooting)

**Q. μ‚¬μ©μκ°€ λ°°ν¬ν•λ‹¤κ°€ "Valid networks resolving error"κ°€ λ¬λ€μ”.**
A. μ‚¬μ©μκ°€ `specs/*.yaml`μ— μ μ€ λ„¤νΈμ›ν¬ μ΄λ¦„μ΄ `infrastructure/networks.yaml`μ— μ •μλμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”. μ¤νƒ€μΌ ν™•λ¥  99%μ…λ‹λ‹¤.

**Q. ν…ν”λ¦Ώμ„ μμ •ν•κ³  μ‹¶μ–΄μ”.**
A. `infrastructure/templates/` ν΄λ” μ•μ `vm_template.yaml` λ“±μ„ μμ •ν•μ„Έμ”. Jinja2 λ¬Έλ²•μ„ λ”°λ¦…λ‹λ‹¤.
