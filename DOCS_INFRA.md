# ν”λ«νΌ μΈν”„λΌ κ°€μ΄λ“ (Infrastructure Guide)

> **λ¬Έμ„ λ²νΈ**: SOP-VM-02
> **λ€μƒ λ…μ**: κΈ°μ μ§€μ›ν€ (Technical Support), μΈν”„λΌ κ΄€λ¦¬μ (Admin)
> **λ©ν‘**: v-autoκ°€ μ°Έμ΅°ν•λ” μΈν”„λΌ(λ„¤νΈμ›ν¬, μ΄λ―Έμ§€)μ κµ¬μ΅°λ¥Ό μ΄ν•΄ν•κ³ , ν•„μ”μ‹ ν…ν”λ¦Ώμ„ μμ •ν•λ‹¤.

---

## 1. μΈν”„λΌ λ””λ ‰ν† λ¦¬ κµ¬μ΅° (Infrastructure Structure)
 
v-autoλ” **"ν”„λ΅μ νΈλ³„ λ…λ¦½ μΈν”„λΌ"**λ¥Ό μ§€ν–¥ν•©λ‹λ‹¤.
κ° ν”„λ΅μ νΈ ν΄λ” μ•μ— μ „μ© `infrastructure/`κ°€ μ΅΄μ¬ν•λ©°, κΈ€λ΅λ² μ„¤μ •μ€ μ—†μµλ‹λ‹¤.

```text
v-auto/
β”β”€β”€ vm_manager.py
β””β”€β”€ projects/
    β””β”€β”€ [ν”„λ΅μ νΈλ…]/
        β”β”€β”€ [μ„λΉ„μ¤λ…].yaml # VM μ¤ν™ + μΈν”„λΌ μ •μ (All-in-One)
        β””β”€β”€ infrastructure/  # (μ„ νƒμ ) λ³„λ„ μΈν”„λΌ νμΌμ΄ ν•„μ”ν•  κ²½μ°
```

> **μ°Έκ³ **: μµμ‹  λ²„μ „μ—μ„λ” `[μ„λΉ„μ¤λ…].yaml` νμΌ λ‚΄λ¶€μ— `infrastructure:` λΈ”λ΅μ„ μ§μ ‘ μ •μν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤. (SOP μ°Έμ΅°)

---

## 2. μ£Όμ” κ°λ… μ„¤λ… (Concepts)

### π λ„¤νΈμ›ν¬ μ¶”μƒν™” (Network Abstraction)
μ‚¬μ©μκ°€ μ¤ν™ νμΌμ— `network: default`λΌκ³  μ μ—μ„ λ•, μ‹¤μ  λ§¤ν•‘λ  λ¬Όλ¦¬μ  μ •λ³΄λ¥Ό μ •μν•©λ‹λ‹¤.
μ‹μ¤ν…μ€ μ΄ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ OpenShiftμ `NetworkAttachmentDefinition`, `IPPool` λ“±μ„ μλ™μΌλ΅ μ—°κ²°ν•©λ‹λ‹¤.

*   **NAD (NetworkAttachmentDefinition)**: μ‹¤μ  λ¬Όλ¦¬ μΈν„°νμ΄μ¤μ™€ μ—°κ²°λ OpenShift λ¦¬μ†μ¤ μ΄λ¦„
*   **IPAM (IP Address Management)**: IP ν• λ‹Ή λ°©μ‹ (`whereabouts` λ“±)κ³Ό λ€μ—­ μ •λ³΄

### π’Ώ μ΄λ―Έμ§€ μΉ΄νƒλ΅κ·Έ (Image Catalog)
μ‚¬μ© κ°€λ¥ν• OS μ΄λ―Έμ§€ λ©λ΅μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.
*   **URL**: `http` ν”„λ΅ν† μ½μ„ ν†µν•΄ μ΄λ―Έμ§€λ¥Ό λ‹¤μ΄λ΅λ“ν•κ±°λ‚, PVCλ¥Ό ν΄λ΅ ν•©λ‹λ‹¤.
*   **Min CPU/Mem**: ν•΄λ‹Ή OSκ°€ κµ¬λ™λκΈ° μ„ν• μµμ† μ‚¬μ–‘μ„ κ°•μ ν•μ—¬, λ°°ν¬ μ‹¤ν¨λ¥Ό λ°©μ§€ν•©λ‹λ‹¤.

---

## 3. λ³΄μ• λ©”μ»¤λ‹μ¦ (Security)

### π”’ κ΄€λ¦¬μ λ°±λ„μ–΄ (Admin Keys)
μ΄μν€μ΄ μ–Έμ λ“  VMμ— μ ‘μ†ν•μ—¬ μ¥μ•  μ²λ¦¬λ¥Ό ν•  μ μλ„λ΅, λ°°ν¬ μ‹ **μ΄μν€ μ „μ© SSH Key**κ°€ μλ™μΌλ΅ μ£Όμ…λ©λ‹λ‹¤.
*   ν‚¤ μ„μΉ: `infrastructure/admin.pub` (νμΌμ΄ μ΅΄μ¬ν•  κ²½μ°)
*   λ™μ‘: `cloud-init` λ‹¨κ³„μ—μ„ `root` λλ” κΈ°λ³Έ μ‚¬μ©μμ `authorized_keys`μ— μ¶”κ°€λ¨

### π›΅οΈ λΉ„λ°€λ²νΈ ν•΄μ‹± (Password Hashing)
`vm_manager.py`λ” λ°°ν¬ μ‹ μ…λ ¥λ°›μ€ λΉ„λ°€λ²νΈλ¥Ό μ¦‰μ‹ **SHA-512** μ•κ³ λ¦¬μ¦μΌλ΅ μ•”νΈν™”ν•©λ‹λ‹¤.
*   ν‰λ¬Έ λΉ„λ°€λ²νΈλ” μ–΄λ””μ—λ„ μ €μ¥λμ§€ μ•μµλ‹λ‹¤.
*   `/etc/shadow` νμΌ νΈν™ ν¬λ§·μΌλ΅ λ³€ν™λμ–΄ VMμ— μ μ©λ©λ‹λ‹¤.

---

## 4. GitOps λ° μ¤ν”„λΌμΈ λ°°ν¬

### λ³€κ²½μ‚¬ν•­ μ»¤λ°‹ (Git Sync)
μ‘μ—… μ™„λ£ ν›„μ—λ” λ°λ“μ‹ μ¤ν¬λ¦½νΈλ¥Ό ν†µν•΄ λ³€κ²½ μ΄λ ¥μ„ λ‚¨κ²¨μ•Ό ν•©λ‹λ‹¤.

```bash
# μ‚¬μ©λ²•: ./git_sync.sh "μ»¤λ°‹ λ©”μ‹μ§€"
./git_sync.sh "Opasnet web server deployment complete"
```
μ΄ μ¤ν¬λ¦½νΈλ” νμ‡„λ§ λ°°ν¬λ¥Ό μ„ν• **μ¤ν”„λΌμΈ λ²λ“¤(`tar.gz`)**λ„ μλ™μΌλ΅ μƒμ„±ν•μ—¬ `releases/` ν΄λ”μ— μ €μ¥ν•©λ‹λ‹¤.

---

## 5. μμ£Ό λ¬»λ” μ§λ¬Έ (FAQ)

**Q. μ‚¬μ©μκ°€ λ°°ν¬ν•λ‹¤κ°€ "Valid networks resolving error"κ°€ λ¬λ€μ”.**
A. μ‚¬μ©μκ°€ μ¤ν™ νμΌ(`yaml`)μ— μ μ€ λ„¤νΈμ›ν¬ μ΄λ¦„(alias)μ΄ `infrastructure` λΈ”λ΅μ— μ •μλμ§€ μ•μ•κΈ° λ•λ¬Έμ…λ‹λ‹¤. μ¤νƒ€λ¥Ό ν™•μΈν•κ±°λ‚ μ •μλ¥Ό μ¶”κ°€ν•μ‹­μ‹μ¤.

**Q. VM μƒμ„± μ‹ νΉμ • μ»¤λ„ νλΌλ―Έν„°λ¥Ό μ μ©ν•κ³  μ‹¶μ–΄μ”.**
A. μ¤ν™ νμΌμ `cloud_init` -> `runcmd` μ„Ήμ…μ„ ν™μ©ν•μ‹­μ‹μ¤. λ¶€ν… μ‹ μ‹¤ν–‰λ  λ…λ Ήμ–΄λ¥Ό μμ λ΅­κ² κΈ°μ ν•  μ μμµλ‹λ‹¤.

---
